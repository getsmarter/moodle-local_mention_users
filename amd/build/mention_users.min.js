define(["jquery","local_mention_users/tribute"],function(e){var t={};return t.init=function(){var t=e("input[name=reply]").val();if(e("input[name=forum]").length>0)var n=e("input[name=forum]").val();else n=0;if(/hsuforum/.test(window.location.href))var a=1;else a=0;var o=function(){scrollBy(0,-70)};location.hash&&o(),window.addEventListener("hashchange",o),function(t,n,a){var o=window.location.pathname.indexOf("/mod/hsuforum/view.php")>-1;e.ajax({dataType:"json",url:"/local/mention_users/getusers.php",data:"action=tribute&reply="+t+"&forum="+n+"&advancedforum="+a+"&new_discussion="+o,success:function(t){t.result?function(t,n){var a=JSON.parse(t),o=[];for(i=0;i<a.length;i+=2)o.push({key:a[i],value:a[i+1]});var r,u,d,l=new Tribute({collection:[{selectTemplate:function(e){return'<span contenteditable="false"><a href='+window.location.origin+"/user/view.php?id="+e.original.value+"&course="+n+' target="_blank" userid="'+e.original.value+'">@'+e.original.key+"</a></span>"},values:o}]});document.getElementById("id_messageeditable")&&e(document).ready(function(){l.attach(document.getElementById("id_messageeditable"))}),document.addEventListener("DOMSubtreeModified",(r=function(){e(".hsuforum-textarea").attr("data-tribute")||l.attach(document.querySelectorAll(".hsuforum-textarea")),e("#hiddenadvancededitoreditable").attr("data-tribute")||l.attach(document.querySelectorAll("#hiddenadvancededitoreditable"))},u=50,d=0,function(){var e=arguments,t=this;clearTimeout(d),d=setTimeout(function(){r.apply(t,e)},u)}),!1)}(t.content,t.courseid):window.alert(t.content)}})}(t,n,a)},t});
