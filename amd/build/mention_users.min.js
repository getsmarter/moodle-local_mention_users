define(["jquery","local_mention_users/tribute"],function(a){var b={};return b.init=function(){function b(b,c,e){a.ajax({dataType:"json",url:"/local/mention_users/getusers.php",data:"action=tribute&reply="+b+"&forum="+c+"&advancedforum="+e,success:function(a){a.result?d(a.content,a.courseid):window.alert(a.content)}})}function c(a){url=window.location.href,a=a.replace(/[\[\]]/g,"\\$&");var b=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),c=b.exec(url);return c?c[2]?decodeURIComponent(c[2].replace(/\+/g," ")):"":null}function d(b,c){var d=JSON.parse(b),e=[];for(i=0;i<d.length;i+=2)e.push({key:d[i],value:d[i+1]});var f=new Tribute({collection:[{selectTemplate:function(a){return'<span contenteditable="false"><a href='+window.location.origin+"/user/view.php?id="+a.original.value+"&course="+c+' target="_blank" userid="'+a.original.value+'">@'+a.original.key+"</a></span>"},values:e}]});document.getElementById("id_messageeditable")&&a(document).ready(function(){f.attach(document.getElementById("id_messageeditable"))}),a(document).bind("DOMSubtreeModified",function(){a(".hsuforum-textarea").attr("data-tribute")||f.attach(document.querySelectorAll(".hsuforum-textarea"))})}var e=a("input[name=reply]").val();if(a("input[name=forum]").length>0)var f=a("input[name=forum]").val();else var f=c("d");if(/hsuforum/.test(window.location.href))var g=1;else var g=0;var h=function(){scrollBy(0,-70)};location.hash&&h(),window.addEventListener("hashchange",h),b(e,f,g)},b});