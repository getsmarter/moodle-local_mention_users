define(["jquery","core/ajax","local_mention_users/tribute"],function(e,t){var n={};return n.init=function(){var n=e("input[name=reply]").val();if(e("input[name=forum]").length>0)var a=e("input[name=forum]").val();else a=0;if(/hsuforum/.test(window.location.href))var o=1;else o=0;var r=function(){scrollBy(0,-70)};location.hash&&r(),window.addEventListener("hashchange",r),function(n,a,o){var r=window.location.pathname.indexOf("/mod/hsuforum/view.php")>-1;t.call([{methodname:"local_mention_users_getusers",args:{action:"tribute",reply:n,forum:a,advancedforum:o,newdiscussion:r}}])[0].done(function(t){if(!t.result)throw t.content;!function(t,n){var a=JSON.parse(t),o=[];for(i=0;i<a.length;i+=2)o.push({key:a[i],value:a[i+1]});var r,u,l,d=new Tribute({collection:[{selectTemplate:function(e){return'<span contenteditable="false"><a href='+window.location.origin+"/user/view.php?id="+e.original.value+"&course="+n+' target="_blank" userid="'+e.original.value+'">@'+e.original.key+"</a></span>"},values:o}]});document.getElementById("id_messageeditable")&&e(document).ready(function(){d.attach(document.getElementById("id_messageeditable"))}),document.addEventListener("DOMSubtreeModified",(r=function(){e(".hsuforum-textarea").attr("data-tribute")||d.attach(document.querySelectorAll(".hsuforum-textarea")),e("#hiddenadvancededitoreditable").attr("data-tribute")||d.attach(document.querySelectorAll("#hiddenadvancededitoreditable"))},u=50,l=0,function(){var e=arguments,t=this;clearTimeout(l),l=setTimeout(function(){r.apply(t,e)},u)}),!1)}(t.content,t.courseid)}).fail(function(e){throw e})}(n,a,o)},n});