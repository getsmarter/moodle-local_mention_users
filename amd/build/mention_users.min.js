define ("local_mention_users/mention_users",["jquery","core/ajax","local_mention_users/tribute"],function(a,b){return{init:function(){var e=a("input[name=reply]").val();if(0<a("input[name=forum]").length){var f=a("input[name=forum]").val()}else{var f=0}if(/hsuforum/.test(window.location.href)){var g=1}else{var g=0}function c(a,c,e){var f=-1<window.location.pathname.indexOf("/mod/hsuforum/view.php"),g=b.call([{methodname:"local_mention_users_getusers",args:{action:"tribute",reply:a,forum:c,advancedforum:e,newdiscussion:f}}]);g[0].done(function(a){if(a.result){d(a.content,a.courseid)}else{throw a.content}}).fail(function(a){throw a})}function d(b,c){var d=JSON.parse(b),e=[];for(i=0;i<d.length;i+=2){e.push({key:d[i],value:d[i+1]})}var f=new Tribute({collection:[{selectTemplate:function selectTemplate(a){return"<span contenteditable=\"false\"><a href="+window.location.origin+"/user/view.php?id="+a.original.value+"&course="+c+" target=\"_blank\" userid=\""+a.original.value+"\">@"+a.original.key+"</a></span>"},values:e}]});window.tributeinstance=f;window.usersarray=e;var g=null,h=window.location.search.match(/u=(\d+)/),j=!1,k=!1;if(null!==h){j=!0;k=""!==window.location.hash;g=e.filter(function(a){return a.value==h[1]})[0]}if(document.getElementById("id_messageeditable")){a(document).ready(function(){f.attach(document.getElementById("id_messageeditable"))})}document.addEventListener("DOMSubtreeModified",function(a,b){var c=0;return function(){var d=arguments,e=this;clearTimeout(c);c=setTimeout(function(){a.apply(e,d)},b)}}(function(){if(!a(".hsuforum-textarea").attr("data-tribute")){f.attach(document.querySelectorAll(".hsuforum-textarea"))}if(!a("#hiddenadvancededitoreditable").attr("data-tribute")){f.attach(document.querySelectorAll("#hiddenadvancededitoreditable"));if(j&&!k){a(".hsuforum-textarea").append("<span contenteditable=\"false\"><a href="+window.location.origin+"/user/view.php?id="+g.value+"&course="+c+" target=\"_blank\" userid=\""+g.value+"\">@"+g.key+"</a></span>&nbsp;");a(".hsuforum-textarea").get(0).scrollIntoView()}else if(j&&k){a(".hsuforum-textarea").empty()}}if(!a("#hiddenadvancededitoreditable").attr("data-tribute")){f.attach(document.querySelectorAll("#hiddenadvancededitoreditable"));if(j&&!k){a("#hiddenadvancededitoreditable").append("<span contenteditable=\"false\"><a href="+window.location.origin+"/user/view.php?id="+g.value+"&course="+c+" target=\"_blank\" userid=\""+g.value+"\">@"+g.key+"</a></span>&nbsp;");a("#hiddenadvancededitoreditable").get(0).scrollIntoView()}else if(j&&k){a("#hiddenadvancededitoreditable").empty()}}},50),!1)}var h=function(){scrollBy(0,-70)};if(location.hash)h();window.addEventListener("hashchange",h);window.addEventListener("hashchange",function(){setTimeout(function(){a(".hsuforum-textarea").empty();a("#hiddenadvancededitoreditable").empty()},1e3)});c(e,f,g)}}});
//# sourceMappingURL=mention_users.min.js.map
