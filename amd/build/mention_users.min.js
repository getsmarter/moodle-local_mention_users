define(["jquery","local_mention_users/tribute"],function(a){var b={};return b.init=function(){function b(b,d,e){a.ajax({dataType:"json",url:"/local/mention_users/getusers.php",data:"action=tribute&reply="+b+"&forum="+d+"&advancedforum="+e,success:function(a){a.result?c(a.content,a.courseid):window.alert(a.content)}})}function c(b,c){function d(a,b){var c=0;return function(){var d=arguments,e=this;clearTimeout(c),c=setTimeout(function(){a.apply(e,d)},b)}}var e=JSON.parse(b),f=[];for(i=0;i<e.length;i+=2)f.push({key:e[i],value:e[i+1]});var g=new Tribute({collection:[{selectTemplate:function(a){return'<span contenteditable="false"><a href='+window.location.origin+"/user/view.php?id="+a.original.value+"&course="+c+' target="_blank" userid="'+a.original.value+'">@'+a.original.key+"</a></span>"},values:f}]});document.getElementById("id_messageeditable")&&a(document).ready(function(){g.attach(document.getElementById("id_messageeditable"))}),document.addEventListener("DOMSubtreeModified",d(function(){a(".hsuforum-textarea").attr("data-tribute")||g.attach(document.querySelectorAll(".hsuforum-textarea")),a("#hiddenadvancededitoreditable").attr("data-tribute")||g.attach(document.querySelectorAll("#hiddenadvancededitoreditable"))},50),!1)}var d=a("input[name=reply]").val();if(a("input[name=forum]").length>0)var e=a("input[name=forum]").val();else var e=0;if(/hsuforum/.test(window.location.href))var f=1;else var f=0;var g=function(){scrollBy(0,-70)};location.hash&&g(),window.addEventListener("hashchange",g),b(d,e,f)},b});