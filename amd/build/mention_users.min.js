define(["jquery","local_mention_users/tribute"],function(a){var b={};return b.init=function(){function b(b,d,e,f){a.ajax({dataType:"json",url:"/local/mention_users/getusers.php",data:"action=tribute&reply="+b+"&forum="+d+"&group="+e+"&advancedforum="+f,success:function(a){a.result?c(a.content,a.courseid):window.alert(a.content)}})}function c(b,c){var d=JSON.parse(b),e=[];for(i=0;i<d.length;i+=2)e.push({key:d[i],value:d[i+1]});var f=new Tribute({collection:[{selectTemplate:function(a){return'<span contenteditable="false"><a href='+window.location.origin+"/user/view.php?id="+a.original.value+"&course="+c+' target="_blank" userid="'+a.original.value+'">@'+a.original.key+"</a></span>"},values:e}]});document.getElementById("id_messageeditable")&&a(document).ready(function(){f.attach(document.getElementById("id_messageeditable"))}),a(document).bind("DOMSubtreeModified",function(){a(".hsuforum-textarea").attr("data-tribute")||f.attach(document.querySelectorAll(".hsuforum-textarea"))})}var d=a("input[name=reply]").val(),e=a("input[name=forum]").val();if(/hsuforum/.test(window.location.href)){var f=1,g=a(".hsuforum-thread-byline");g.find("a").remove();var h=g.text().trim(),j=a("#hsuforum-discussion-template").html(),k=j.split('">'+h)[0].split('value="'),l=k[k.length-1]}else var f=0,l=a("input[name=groupid]").val();var m=function(){scrollBy(0,-70)};location.hash&&m(),window.addEventListener("hashchange",m),b(d,e,l,f)},b});